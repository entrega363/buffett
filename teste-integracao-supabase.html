<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Integra√ß√£o Supabase - Buffet Sobral</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .header { background: linear-gradient(135deg, #e91e63, #9c27b0); color: white; padding: 20px; text-align: center; border-radius: 12px; margin-bottom: 20px; }
        .content { max-width: 800px; margin: 0 auto; }
        .test-section { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn { background: #9c27b0; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 10px 5px; }
        .btn:hover { background: #7b1fa2; }
        .result { margin: 15px 0; padding: 15px; border-radius: 8px; }
        .success { background: #e8f5e8; border: 1px solid #4caf50; color: #2e7d32; }
        .error { background: #ffebee; border: 1px solid #f44336; color: #c62828; }
        .info { background: #e3f2fd; border: 1px solid #2196f3; color: #0d47a1; }
        #console { background: #000; color: #00ff00; padding: 15px; border-radius: 4px; font-family: monospace; height: 300px; overflow-y: auto; margin: 20px 0; }
        .data-display { background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin: 10px 0; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ Teste de Integra√ß√£o Supabase</h1>
        <div>Buffet Sobral - Diagn√≥stico de Conex√£o</div>
    </div>

    <div class="content">
        <div class="test-section">
            <h2>Configura√ß√£o e Teste de Conex√£o</h2>
            <button class="btn" onclick="testSupabaseConnection()">Testar Conex√£o Supabase</button>
            <button class="btn" onclick="loadServices()">Carregar Servi√ßos</button>
            <button class="btn" onclick="loadReviews()">Carregar Avalia√ß√µes</button>
            <button class="btn" onclick="loadAllData()">Carregar Todos os Dados</button>
        </div>

        <div class="test-section">
            <h2>Dados Carregados</h2>
            <div id="dataDisplay">
                <p style="text-align: center; color: #666;">Nenhum dado carregado ainda. Clique nos bot√µes acima para testar.</p>
            </div>
        </div>

        <div class="test-section">
            <h2>Console de Diagn√≥stico</h2>
            <div id="console">> Console de diagn√≥stico iniciado...</div>
            <button class="btn" onclick="clearConsole()">Limpar Console</button>
        </div>
    </div>

    <script>
        // Configura√ß√£o do Supabase
        const SUPABASE_URL = 'https://vopekxfyorbuyrvzcshy.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvcGVreGZ5b3JidXlydnpjc2h5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0NTkyNjMsImV4cCI6MjA3MzAzNTI2M30.jIQqu4j_0QfPpn67YXHyy760X6Z4wwhuHMj-xK3emP4';
        
        let supabaseClient = null;
        
        // Fun√ß√£o para logar no console
        function logToConsole(message, type = 'info') {
            const consoleElement = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const typeSymbol = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${typeSymbol} ${message}`;
            consoleElement.appendChild(logEntry);
            consoleElement.scrollTop = consoleElement.scrollHeight;
            
            // Tamb√©m logar no console real
            if (type === 'error') {
                console.error(message);
            } else if (type === 'success') {
                console.log(message);
            } else if (type === 'warning') {
                console.warn(message);
            } else {
                console.info(message);
            }
        }
        
        // Fun√ß√£o para mostrar resultados
        function showResult(message, isSuccess = true) {
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${isSuccess ? 'success' : 'error'}`;
            resultDiv.innerHTML = `${isSuccess ? '‚úÖ' : '‚ùå'} ${message}`;
            document.querySelector('.content').insertBefore(resultDiv, document.querySelector('.content').lastChild);
            
            // Remover ap√≥s 5 segundos
            setTimeout(() => {
                if (resultDiv.parentNode) {
                    resultDiv.parentNode.removeChild(resultDiv);
                }
            }, 5000);
        }
        
        // Fun√ß√£o para mostrar dados
        function showData(title, data) {
            const dataDisplay = document.getElementById('dataDisplay');
            const dataDiv = document.createElement('div');
            dataDiv.className = 'data-display';
            dataDiv.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            dataDisplay.innerHTML = '';
            dataDisplay.appendChild(dataDiv);
        }
        
        // Testar conex√£o com Supabase
        async function testSupabaseConnection() {
            logToConsole('Iniciando teste de conex√£o com Supabase...');
            
            try {
                // Verificar se o cliente Supabase est√° dispon√≠vel
                if (typeof supabase === 'undefined') {
                    logToConsole('‚ùå Cliente Supabase n√£o carregado', 'error');
                    showResult('Cliente Supabase n√£o carregado', false);
                    return;
                }
                
                logToConsole('‚úÖ Cliente Supabase dispon√≠vel');
                
                // Criar cliente
                supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                logToConsole('‚úÖ Cliente Supabase criado com sucesso');
                
                // Testar conex√£o simples
                const { data, error } = await supabaseClient
                    .from('services')
                    .select('id')
                    .limit(1);
                
                if (error) {
                    logToConsole(`‚ùå Erro na conex√£o: ${error.message}`, 'error');
                    showResult(`Erro na conex√£o: ${error.message}`, false);
                    return;
                }
                
                logToConsole('‚úÖ Conex√£o com Supabase estabelecida com sucesso', 'success');
                showResult('Conex√£o com Supabase estabelecida com sucesso');
                
            } catch (error) {
                logToConsole(`‚ùå Erro no teste de conex√£o: ${error.message}`, 'error');
                showResult(`Erro no teste de conex√£o: ${error.message}`, false);
            }
        }
        
        // Carregar servi√ßos
        async function loadServices() {
            logToConsole('Iniciando carregamento de servi√ßos...');
            
            if (!supabaseClient) {
                logToConsole('‚ùå Cliente Supabase n√£o inicializado. Execute primeiro o teste de conex√£o.', 'error');
                showResult('Cliente Supabase n√£o inicializado', false);
                return;
            }
            
            try {
                const { data, error } = await supabaseClient
                    .from('services')
                    .select('*');
                
                if (error) {
                    logToConsole(`‚ùå Erro ao carregar servi√ßos: ${error.message}`, 'error');
                    showResult(`Erro ao carregar servi√ßos: ${error.message}`, false);
                    return;
                }
                
                logToConsole(`‚úÖ ${data.length} servi√ßos carregados com sucesso`, 'success');
                showData('Servi√ßos', data);
                showResult(`Servi√ßos carregados (${data.length} itens)`);
                
            } catch (error) {
                logToConsole(`‚ùå Erro ao carregar servi√ßos: ${error.message}`, 'error');
                showResult(`Erro ao carregar servi√ßos: ${error.message}`, false);
            }
        }
        
        // Carregar avalia√ß√µes
        async function loadReviews() {
            logToConsole('Iniciando carregamento de avalia√ß√µes...');
            
            if (!supabaseClient) {
                logToConsole('‚ùå Cliente Supabase n√£o inicializado. Execute primeiro o teste de conex√£o.', 'error');
                showResult('Cliente Supabase n√£o inicializado', false);
                return;
            }
            
            try {
                const { data, error } = await supabaseClient
                    .from('reviews')
                    .select('*');
                
                if (error) {
                    logToConsole(`‚ùå Erro ao carregar avalia√ß√µes: ${error.message}`, 'error');
                    showResult(`Erro ao carregar avalia√ß√µes: ${error.message}`, false);
                    return;
                }
                
                logToConsole(`‚úÖ ${data.length} avalia√ß√µes carregadas com sucesso`, 'success');
                showData('Avalia√ß√µes', data);
                showResult(`Avalia√ß√µes carregadas (${data.length} itens)`);
                
            } catch (error) {
                logToConsole(`‚ùå Erro ao carregar avalia√ß√µes: ${error.message}`, 'error');
                showResult(`Erro ao carregar avalia√ß√µes: ${error.message}`, false);
            }
        }
        
        // Carregar todos os dados
        async function loadAllData() {
            logToConsole('Iniciando carregamento completo de dados...');
            
            if (!supabaseClient) {
                await testSupabaseConnection();
            }
            
            if (!supabaseClient) {
                logToConsole('‚ùå N√£o foi poss√≠vel inicializar o cliente Supabase', 'error');
                return;
            }
            
            try {
                // Carregar servi√ßos
                await loadServices();
                
                // Carregar avalia√ß√µes
                await loadReviews();
                
                // Carregar fotos do espa√ßo
                const { data: photos, error: photosError } = await supabaseClient
                    .from('space_photos')
                    .select('*');
                
                if (photosError) {
                    logToConsole(`‚ùå Erro ao carregar fotos: ${photosError.message}`, 'error');
                } else {
                    logToConsole(`‚úÖ ${photos.length} fotos carregadas`, 'success');
                }
                
                // Carregar informa√ß√µes de contato
                const { data: contacts, error: contactsError } = await supabaseClient
                    .from('contact_info')
                    .select('*');
                
                if (contactsError) {
                    logToConsole(`‚ùå Erro ao carregar contatos: ${contactsError.message}`, 'error');
                } else {
                    logToConsole(`‚úÖ ${contacts.length} contatos carregados`, 'success');
                }
                
                // Carregar v√≠deos em destaque
                const { data: videos, error: videosError } = await supabaseClient
                    .from('featured_videos')
                    .select('*');
                
                if (videosError) {
                    logToConsole(`‚ùå Erro ao carregar v√≠deos: ${videosError.message}`, 'error');
                } else {
                    logToConsole(`‚úÖ ${videos.length} v√≠deos carregados`, 'success');
                }
                
                logToConsole('‚úÖ Carregamento completo de dados conclu√≠do', 'success');
                showResult('Carregamento completo de dados conclu√≠do');
                
            } catch (error) {
                logToConsole(`‚ùå Erro no carregamento completo: ${error.message}`, 'error');
                showResult(`Erro no carregamento completo: ${error.message}`, false);
            }
        }
        
        // Limpar console
        function clearConsole() {
            document.getElementById('console').innerHTML = '> Console limpo...
';
        }
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            logToConsole('‚úÖ P√°gina de teste carregada com sucesso', 'success');
            logToConsole('‚úÖ Clique nos bot√µes para executar os testes', 'info');
        });
        
        logToConsole('‚úÖ Script inicializado', 'success');
    </script>
</body>
</html>